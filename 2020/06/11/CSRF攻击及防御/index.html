<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>CSRF攻击及防御 | null</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css"><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><link rel="icon" href="/favicon.ico"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#CSRF概述"><span class="toc-number">1.</span> <span class="toc-text">CSRF概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DVWA模拟CSRF"><span class="toc-number">2.</span> <span class="toc-text">DVWA模拟CSRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同源策略不能有效防止CSRF"><span class="toc-number">3.</span> <span class="toc-text">同源策略不能有效防止CSRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#防御方法："><span class="toc-number">4.</span> <span class="toc-text">防御方法：</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Y0un9</div><div class="author-info__description text-center">Y0un9的博客</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">17</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://attach.bbs.miui.com/forum/201306/23/110328s72xxse7lfis9fnd.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/"></a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">CSRF攻击及防御</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-06-11 </time></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h4 id="CSRF概述"><a href="#CSRF概述" class="headerlink" title="CSRF概述"></a>CSRF概述</h4><p>CSRF(跨站请求伪造)本质上是在用户已登录的情况下，点开另外一个由hacker恶意构造的网站。（同一浏览器中点开），由于浏览器会存储用户的cookie，hacker可以盗取此时用户的cookie来进行一些违规操作。（这一点比较像XSS）,用DVWA做一个实验。</p>
<p>盗一张百度百科的图</p>
<p><img src="/images/pasted-50.png" alt="upload successful"></p>
<h4 id="DVWA模拟CSRF"><a href="#DVWA模拟CSRF" class="headerlink" title="DVWA模拟CSRF"></a>DVWA模拟CSRF</h4><p>这里在win10虚拟机内使用phpstudy搭建DVWA靶场。在根目录下写入一个csrf.html文件。</p>
<p>恶意代码如下。192.168.124.137是DVWA靶场地址</p>
<p><img src="/images/pasted-45.png" alt="upload successful"></p>
<p>在DVWA中将安全级别调至low。当我们修改密码时会发送get请求，参数中带有我们请求的数据。</p>
<p><img src="/images/pasted-46.png" alt="upload successful"></p>
<p>保持登录状态，访问csrf.html页面,此时没什么特殊，用户会以为点击了一个无效界面。但此时用户名和密码已经更改了。尝试一下使用root登录。登录成功</p>
<p><img src="/images/pasted-49.png" alt="upload successful"></p>
<h4 id="同源策略不能有效防止CSRF"><a href="#同源策略不能有效防止CSRF" class="headerlink" title="同源策略不能有效防止CSRF"></a>同源策略不能有效防止CSRF</h4><p>先看一下同源策略的概念：</p>
<p><strong>同源策略是浏览器的一个安全功能，不同源的客户端脚本在没有明确授权的情况下，不能读写对方资源。同源策略限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的重要安全机制。</strong></p>
<ol>
<li><p>页面中的链接，重定向以及表单提交是不会受到同源策略限制的。</p>
</li>
<li><p>跨域资源的引入是可以的。但是js不能读写加载的内容。如嵌入到页面中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;...&quot;&gt;&lt;&#x2F;script&gt;，&lt;img&gt;，&lt;link&gt;，&lt;iframe&gt;</span><br></pre></td></tr></table></figure>
<p>可以看出：</p>
</li>
</ol>
<p><strong>同源策略仅仅阻止了脚本读取来自其他站点的内容。但是却没有防止向其他站点发出请求。因为CSRF攻击是由于某些请求被发出，而引起在服务器端执行了某些动作所引起的，所以同源策略无法防止CSRF攻击。</strong></p>
<p>因此我们可以使用a标签,img标签实现CSRF</p>
<h4 id="防御方法："><a href="#防御方法：" class="headerlink" title="防御方法："></a>防御方法：</h4><ol>
<li><p>前端使用POST方式传递表单数据，后台也仅接受POST数据。这样可以防止hacker利用<code>scr</code>来发起GET请求。这样能抵御一部分攻击，但本身其实也并不安全。hacker可以构造js代码，发送post请求。</p>
</li>
<li><p>使用 Referer来验证请求的来源。但是这样也有一个缺点，hacker可以将服务器页面改为对应的xxx.html来绕绕过</p>
</li>
<li><p>验证码：<br>这个方案的思路是：每次的用户提交都需要用户在表单中填写一个图片上的随机字符串，这个方案可以完全解决CSRF，但是易用性不太好。</p>
</li>
<li><p>token认证</p>
</li>
</ol>
<p>CSRF 攻击之所以能够成功，是因为黑客可以完全伪造用户的请求，该请求中所有的用户验证信息都是存在于 cookie 中，因此黑客可以在不知道这些验证信息的情况下直接利用用户自己的 cookie 来通过安全验证。要抵御 CSRF，关键在于在请求中放入黑客所不能伪造的信息，并且该信息不存在于 cookie 之中。可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务器端建立一个拦截器来验证这个 token，如果请求中没有 token 或者 token 内容不正确，则认为可能是 CSRF 攻击而拒绝该请求。</p>
<p>Token是在服务端产生的。如果前端使用用户名和密码向服务端发送请求认证，服务端认证成功，那么在服务端会返回Token给前端。前端可以在每次请求的时候带上Token证明自己的合法地位。如果Token在服务端持久化，那他就是一个永久的身份令牌。</p>
<p>一个用户必须要输入用户名密码并验证通过后，服务器才会分配一个Token，传回并储存在客户端作为凭证（同时储存在服务器上）。因此并不是每个人都可以获得这个Token，只有能提供正确用户密码的客户端才可以。</p>
</div><div class="post-meta__tag-list"></div></article><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/06/11/SSRF%E5%8F%8Aweblogic%E6%BC%8F%E6%B4%9E%E5%AE%9E%E6%88%98/"><i class="fa fa-chevron-left">  </i><span>SSRF及weblogic漏洞实战</span></a></div><div class="next-post pull-right"><a href="/2020/06/09/ARP%E5%8D%8F%E8%AE%AE%E5%8F%8A%E6%94%BB%E5%87%BB/"><span>ARP协议</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">©2013 - 2020 By Y0un9</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span> |  </span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/fancybox.js"></script><script src="/js/sidebar.js"></script><script src="/js/copy.js"></script><script src="/js/fireworks.js"></script><script src="/js/transition.js"></script><script src="/js/scroll.js"></script><script src="/js/head.js"></script></body></html>