<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>文件描述符与重定向 | null</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css"><script>var GLOBAL = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><link rel="icon" href="/favicon.ico"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="null" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-文件描述符"><span class="toc-number">1.</span> <span class="toc-text">1. 文件描述符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-重定向"><span class="toc-number">2.</span> <span class="toc-text">2. 重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-1-输入重定向"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 输入重定向</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-2-输出重定向"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 输出重定向</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-3-标准输出与标准错误输出重定向"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 标准输出与标准错误输出重定向</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-4-文件描述符的复制。"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 文件描述符的复制。</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-5-绑定重定向"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 绑定重定向</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Y0un9</div><div class="author-info__description text-center">Y0un9的博客</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">18</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://attach.bbs.miui.com/forum/201306/23/110328s72xxse7lfis9fnd.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/"></a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">文件描述符与重定向</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-24 </time></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h5 id="1-文件描述符"><a href="#1-文件描述符" class="headerlink" title="1. 文件描述符"></a>1. 文件描述符</h5><ul>
<li><p>文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。可以理解为linux跟踪打开文件，而分配的一个数字。(摘自维基百科)</p>
</li>
<li><p>linux启动时有三个标准的文件描述符</p>
<pre><code>标准输入standard input 0 （默认设备键盘）

标准输出standard output 1（默认设备显示器）

错误输出：error output 2（默认设备显示器）</code></pre></li>
<li><p>由于在Linux中一切皆文件，文件所有输入输出都是由该进程所有打开的文件描述符控制的。</p>
</li>
</ul>
<h5 id="2-重定向"><a href="#2-重定向" class="headerlink" title="2. 重定向"></a>2. 重定向</h5><p>由于标准的文件描述符默认取设备(从键盘读取内容，显示器输出内容)。当我们想要将输出的结果保存在某个文件时，就需要对文件描述符进行重定向。换个角度说，<strong><em>重定向就是针对文件描述符的</em></strong></p>
<ul>
<li><p>首先要注意一点是bash在执行一条执行的时候，首先会检查命令中是否存在重定向的符号，如果存在那么首先将文件描述符重定向，然后在把重定向去掉，执行指令。</p>
</li>
<li><p>重定向中含有多个指令时，从左往右依次解析。(不能随意颠倒顺序)</p>
</li>
<li><p><code>&lt;</code> 是对0进行重定向，<code>&gt;</code>对进行重定向</p>
</li>
</ul>
<h6 id="2-1-输入重定向"><a href="#2-1-输入重定向" class="headerlink" title="2.1 输入重定向"></a>2.1 输入重定向</h6><p>格式：[n]&lt; filename </p>
<p>(<code>[n]</code>与<code>&lt;</code>间没有空格。<code>&lt;</code>与filename间有空格)。</p>
<p>举个小栗子。在linux下新建一个文件，文件名为file，在file中写入 <code>hello wrold</code>  。现在使用输入重定向来读取file中的字符。这里把0省略掉用  <code>&lt; file cat</code> 也是一样的</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/1.png" alt></p>
<p>解析器首先解析指令中是否含有重定向的符号。解析到<code>&lt;</code>时会先处理重定向，把标准输入指向file。最后的cat就会从标准输入读取内容。即输出<code>hello world</code></p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/2.png" alt></p>
<h6 id="2-2-输出重定向"><a href="#2-2-输出重定向" class="headerlink" title="2.2 输出重定向"></a>2.2 输出重定向</h6><p>格式：<code>[n]&gt; filename</code> </p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/3.png" alt></p>
<p>这是首先将标准输出(echo的内容)指向newfile，使用echo输出内容时就会输出到newfile中，不会显示在屏幕上。</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/4.png" alt></p>
<h6 id="2-3-标准输出与标准错误输出重定向"><a href="#2-3-标准输出与标准错误输出重定向" class="headerlink" title="2.3 标准输出与标准错误输出重定向"></a>2.3 标准输出与标准错误输出重定向</h6><p>格式：    </p>
<pre><code>&amp;&gt; file 或
&gt;&amp; file</code></pre><p>两者都等价于 <code>&gt; file 2&gt;&amp;1</code></p>
<p>解释一下第二个。这里先将标准输出指向file，再将标准错误输出复制到标准输出。即标准输入和标准错误输出都指向了file</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/5.png" alt></p>
<h6 id="2-4-文件描述符的复制。"><a href="#2-4-文件描述符的复制。" class="headerlink" title="2.4 文件描述符的复制。"></a>2.4 文件描述符的复制。</h6><p>格式：<code>[n]&lt;&amp;[m] / [n]&gt;&amp;[m]</code></p>
<p>(这里所有字符间都不要空格)</p>
<p>这里两个都是将文件描述符 n 复制到 m ，两者的区别是，前者是以只读的形式打开，后者是以写的形式打开</p>
<p><strong><em>因此 0&lt;&amp;1 和 0&gt;&amp;1 是完全等价的（读/写方式打开对其没有任何影响）</em></strong></p>
<p><strong><em>&amp; 目的是为了区分数字名字的文件和文件描述符，如果没有&amp; 系统会认为是将文件描述符重定向到了一个数字作为文件名的文件，而不是一个文件描述符</em></strong></p>
<p>PS:个人觉得这里的复制不是很好理解。我更愿意理解为指向。将n指向m</p>
<p>这里也举个例子。(这个例子比较重要，看懂这个差不多就明白了前面的内容。)这里有两条指令，不过执行的顺序不同</p>
<pre><code>cmd &gt; file 2&gt;&amp;1

cmd 2&gt;&amp;1 &gt;file</code></pre><ul>
<li>先执行第一条命令，这里的 <code>cmd</code> 我们使用 <code>cat flag</code>。此时flag这个文件并不存在，若直接访问会报错。可以看到将标准错误输出写入了file。</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/6.png" alt></p>
<ul>
<li>现在再用<code>ls</code>代替掉<code>cmd</code>，当使用一个正确的指令时。这里将标准输出也写入了file。</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/7.png" alt></p>
<p><strong>分析一下原理</strong>：首先将标准输出指向file,再将标准错误输出也指向file。这样正确和错误的信息都会写入file。</p>
<ul>
<li>现在看一下第二条语句，要稍微复杂一些。还是举个例子。这里可以看出和第一条命令的执行结果有写不同，这里是把标准错误输出直接显示在控制台，标准输出写入了file文件。</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/8.png" alt></p>
<p><strong>也分析一下原理</strong>：</p>
<ul>
<li>当解析到 <code>2&gt;&amp;1</code>时，将标准错误输出指向标准输出。此时</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/9.png" alt></p>
<ul>
<li>当执行到  <code>&gt;</code>时。将标准输出指向file</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/10.png" alt></p>
<h6 id="2-5-绑定重定向"><a href="#2-5-绑定重定向" class="headerlink" title="2.5 绑定重定向"></a>2.5 绑定重定向</h6><p>上面的输入输出重定向将输入和输出绑定文件只对当前的那条指令有效，如果需要接下来的指令都支持的话就需要使用 exec 指令</p>
<ul>
<li>格式：<code>exec [n] &lt;/&gt; file/[n]</code></li>
</ul>
<p>以读写方式打开word指代的文件，并将n重定向到该文件。如果n不指定的话，默认为标准输入。</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/12.png" alt></p>
<p>逐句分析一下：</p>
<ul>
<li><p><code>exec 4&lt;&gt;file</code> 这里将自定义的文件描述符4指向了file。</p>
</li>
<li><p><code>ls &gt;&amp;4</code> 将ls的结果指向文件描述符4,也就是将标准输出写入到了file中。</p>
</li>
</ul>
<p>PS：大部分内容摘自下面这篇文章，但对其中的指令做了更细节化的解读</p>
<p><a href="https://xz.aliyun.com/t/2548" target="_blank" rel="noopener">参考链接</a></p>
</div><div class="post-meta__tag-list"></div></article><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/05/24/shell%E5%8F%8D%E5%BC%B9/"><i class="fa fa-chevron-left">  </i><span>shell反弹</span></a></div><div class="next-post pull-right"><a href="/2020/05/20/Web2-ikun/"><span>[Web2]ikun</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">©2013 - 2020 By Y0un9</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span> |  </span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/fancybox.js"></script><script src="/js/sidebar.js"></script><script src="/js/copy.js"></script><script src="/js/fireworks.js"></script><script src="/js/transition.js"></script><script src="/js/scroll.js"></script><script src="/js/head.js"></script></body></html>