<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>[WesternCTF2018]shrine | Hexo</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
    
<meta name="generator" content="Hexo 4.2.1"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
		</nav>
		<h1 class="header__title"><a href="/">Hexo</a></h1>
		<h2 class="header__subtitle"></h2>
	</header>

	<main>
		<article>
	
		<h1>[WesternCTF2018]shrine</h1>
	
	<div class="article__infos">
		<span class="article__date">2020-05-15</span><br />
		
		
	</div>

	

	
		<p>打开界面出现源码，是一个flask的框架。审计一下</p>
<p><figure class="figure"><img src="1.png" alt=""></figure></p>
<p>1.设置app的配置文件为flag同时删除环境变量中的flag。那么就是要想办法从配置文件中获取flag了。</p>
<p>2.<figure class="figure"><img src="2.png" alt=""></figure></p>
<p>这里过滤掉了<code>()</code>以及config、self。那么就不能直接通过<code></code>或<code></code>来获取配置文件了<br>。<code>self.__dict__</code>内存储着类的静态函数、类函数、普通函数、全局变量以及一些内置的属性。也不能使用<code>__subclasses__()</code>来执行shell命令</p>
<p>最后<code>return flask.render_template_string(safe_jinja(shrine))</code>语句可以确认存在着注入点。先测试一下</p>
<p><code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7B2*2%7D%7D</code></p>
<p><figure class="figure"><img src="3.png" alt=""></figure></p>
<p>3.这里可以用<code>get_flashed_messages(), url_for()</code>来读取配置文件</p>
<p><code>url_for()</code></p>
<p>一般我们通过一个URL就可以执行到某一个函数。如果反过来，我们知道一个函数，怎么去获得这个URL呢？url_for函数就可以帮我们实现这个功能。url_for()函数接收两个及以上的参数，他接收函数名作为第一个参数，接收对应URL规则的命名参数，如果还出现其他的参数，则会添加到URL的后面作为查询参数。</p>
<p><code>get_flashed_messages()</code></p>
<p>返回之前在Flask中通过 flash() 传入的闪现信息列表。把字符串对象表示的消息加入到一个消息队列中，然后通过调用get_flashed_messages() 方法取出(闪现信息只能取出一次，取出后闪现信息会被清空)。</p>
<p>个人理解这两个函数都用于flask，他的全局属性中也就会存储flask当前对象的许多信息，包括配置信息。</p>
<p>3.这里试例url_for()。payload:</p>
<p><code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7Burl_for.__globals__%7D%7D</code></p>
<p><figure class="figure"><img src="4.png" alt=""></figure></p>
<p>这里找到了current_app。也就是当前的app对象的信息。再找到app的配置信息payload:</p>
<p><code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7Burl_for.__globals__[&#39;current_app&#39;].config%7D%7D</code></p>
<p><figure class="figure"><img src="5.png" alt=""></figure></p>
<p>找到了flag。当然用<code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7Burl_for.__globals__[&#39;current_app&#39;].config[&#39;FLAG&#39;]%7D%7D</code>也是一样的。</p>

	

	
		<span class="different-posts"><a href="/2020/05/15/WesternCTF2018-shrine/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2020 John Doe | Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo" target="_blank" rel="noopener">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
